
[1m[46m RUN [49m[22m [36mv4.0.18 [39m[90mD:/code/OSS/alchemy/distilled/distilled-cloudflare[39m

[90mstdout[2m | test/aisearch.test.ts[2m > [22m[2mAISearch[2m > [22m[2mcreateToken[2m > [22m[2mhappy path - creates an AI Search token
[22m[39m[23:50:50.651] DEBUG (#1):
  {
    _id: [32m'@effect/platform/HttpClientRequest'[39m,
    method: [32m'GET'[39m,
    url: [32m'https://api.cloudflare.com/client/v4/accounts/2b29022c8dbd18353220a2f637eeba33/ai-search/tokens'[39m,
    urlParams: [],
    hash: { _id: [32m'Option'[39m, _tag: [32m'None'[39m },
    headers: { [32m'content-type'[39m: [32m'application/json'[39m, authorization: <redacted> },
    body: { _id: [32m'@effect/platform/HttpBody'[39m, _tag: [32m'Empty'[39m }
  }

[90mstdout[2m | test/aisearch.test.ts[2m > [22m[2mAISearch[2m > [22m[2mcreateToken[2m > [22m[2mhappy path - creates an AI Search token
[22m[39m[23:50:50.966] DEBUG (#1):
  {
    status: [33m200[39m,
    headers: Object <[36m[Object: null prototype][39m> {
      [32m'api-version'[39m: [32m'2026-02-19'[39m,
      [32m'cf-auditlog-id'[39m: [32m'019c743c-8c72-7402-9459-a27cf4cf41f4'[39m,
      [32m'cf-ray'[39m: [32m'9d03254d6aeaf5fa-EWR'[39m,
      connection: [32m'keep-alive'[39m,
      [32m'content-encoding'[39m: [32m'gzip'[39m,
      [32m'content-type'[39m: [32m'application/json;charset=UTF-8'[39m,
      date: [32m'Thu, 19 Feb 2026 04:50:51 GMT'[39m,
      server: [32m'cloudflare'[39m,
      [32m'set-cookie'[39m: [32m'_cfuvid=C5HexyPbqCPPTLIFOUvXoij2wQtd9hDZiYSlLlCPVgQ-1771476651341-0.0.1.1-604800000; path=/; domain=.api.cloudflare.com; HttpOnly; Secure; SameSite=None'[39m,
      [32m'transfer-encoding'[39m: [32m'chunked'[39m,
      vary: [32m'Accept-Encoding'[39m
    }
  }

[90mstdout[2m | test/aisearch.test.ts[2m > [22m[2mAISearch[2m > [22m[2mcreateToken[2m > [22m[2mhappy path - creates an AI Search token
[22m[39m[23:50:50.996] DEBUG (#1):
  {
    _id: [32m'@effect/platform/HttpClientRequest'[39m,
    method: [32m'POST'[39m,
    url: [32m'https://api.cloudflare.com/client/v4/accounts/2b29022c8dbd18353220a2f637eeba33/ai-search/tokens'[39m,
    urlParams: [],
    hash: { _id: [32m'Option'[39m, _tag: [32m'None'[39m },
    headers: {
      [32m'content-type'[39m: [32m'application/json'[39m,
      authorization: <redacted>,
      [32m'content-length'[39m: [32m'128'[39m
    },
    body: {
      _id: [32m'@effect/platform/HttpBody'[39m,
      _tag: [32m'Uint8Array'[39m,
      body: [32m'{"cf_api_id":"sam@alchemy.run","cf_api_key":"6ca87a390d51799124488f615efa8ccd11cbc","name":"distilled-cf-aisearch-token-create"}'[39m,
      contentType: [32m'application/json'[39m,
      contentLength: [33m128[39m
    }
  }

[90mstdout[2m | test/aisearch.test.ts[2m > [22m[2mAISearch[2m > [22m[2mcreateToken[2m > [22m[2mhappy path - creates an AI Search token
[22m[39m[23:50:51.250] DEBUG (#1):
  {
    status: [33m400[39m,
    headers: Object <[36m[Object: null prototype][39m> {
      [32m'api-version'[39m: [32m'2026-02-19'[39m,
      [32m'cf-auditlog-id'[39m: [32m'019c743c-8d98-7d3e-b417-2eea58270e62'[39m,
      [32m'cf-ray'[39m: [32m'9d03254f4ec4f5fa-EWR'[39m,
      connection: [32m'keep-alive'[39m,
      [32m'content-length'[39m: [32m'87'[39m,
      [32m'content-type'[39m: [32m'application/json;charset=UTF-8'[39m,
      date: [32m'Thu, 19 Feb 2026 04:50:51 GMT'[39m,
      server: [32m'cloudflare'[39m,
      [32m'set-cookie'[39m: [32m'_cfuvid=OAtXna_82w4_zLQ1QjpC9CwAXYLKnzNGTiWfsNKORcw-1771476651637-0.0.1.1-604800000; path=/; domain=.api.cloudflare.com; HttpOnly; Secure; SameSite=None'[39m,
      vary: [32m'Accept-Encoding'[39m
    }
  }

 [31m‚ùØ[39m test/aisearch.test.ts [2m([22m[2m37 tests[22m[2m | [22m[31m1 failed[39m[2m | [22m[33m36 skipped[39m[2m)[22m[33m 639[2mms[22m[39m
       [2m[90m‚Üì[39m[22m happy path - lists tokens for account
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m happy path - lists instances for account
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
[31m       [31m√ó[31m happy path - creates an AI Search token[39m[33m 637[2mms[22m[39m
       [2m[90m‚Üì[39m[22m happy path - reads an existing token
       [2m[90m‚Üì[39m[22m error - NotFound for non-existent token id
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m happy path - deletes an existing token
       [2m[90m‚Üì[39m[22m error - NotFound for non-existent token id
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m happy path - creates an AI Search instance backed by R2
       [2m[90m‚Üì[39m[22m happy path - reads an existing instance
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m error - InvalidRoute for empty accountId
       [2m[90m‚Üì[39m[22m happy path - deletes an existing instance
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m error - InvalidRoute for empty accountId
       [2m[90m‚Üì[39m[22m happy path - retrieves stats for an existing instance
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m happy path - updates an existing instance
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m happy path - creates a job for an existing instance
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m error - ValidationError for instance id too long
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId
       [2m[90m‚Üì[39m[22m error - NotFound for non-existent token id
       [2m[90m‚Üì[39m[22m error - InvalidRoute for invalid accountId

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[33m36 skipped[39m[90m (37)[39m
[2m   Start at [22m 23:50:48
[2m   Duration [22m 2.71s[2m (transform 249ms, setup 0ms, import 1.87s, tests 639ms, environment 0ms)[22m

